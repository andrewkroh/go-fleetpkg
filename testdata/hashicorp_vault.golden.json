{
  "build": {
    "dependencies": {
      "ecs": {
        "reference": "git@8.7"
      }
    }
  },
  "manifest": {
    "name": "hashicorp_vault",
    "title": "Hashicorp Vault",
    "version": "1.10.0",
    "release": "ga",
    "description": "Collect logs and metrics from Hashicorp Vault with Elastic Agent.",
    "type": "integration",
    "icons": [
      {
        "src": "/img/Vault_VerticalLogo_Color_RGB.svg",
        "title": "Vault Logo",
        "size": "32x32",
        "type": "image/svg+xml"
      }
    ],
    "format_version": "1.0.0",
    "license": "basic",
    "categories": [
      "security",
      "iam"
    ],
    "conditions": {
      "elastic": {},
      "kibana": {
        "version": "^7.17.0 || ^8.0.0"
      }
    },
    "screenshots": [
      {
        "src": "/img/hashicorp_vault-audit-dashboard.png",
        "title": "Audit Log Dashboard",
        "size": "2742x2050",
        "type": "image/png"
      },
      {
        "src": "/img/hashicorp_vault-log-dashboard.png",
        "title": "Audit Log Dashboard",
        "size": "2752x1946",
        "type": "image/png"
      }
    ],
    "source": {},
    "policy_templates": [
      {
        "name": "hashicorp_vault",
        "title": "Hashicorp Vault",
        "description": "Collect logs and monitor Hashicorp Vault.",
        "inputs": [
          {
            "type": "logfile",
            "title": "Logs from file",
            "description": "Collect Vault logs from file."
          },
          {
            "type": "tcp",
            "title": "Logs from TCP socket",
            "description": "Collect Vault audit logs sent via TCP."
          },
          {
            "type": "prometheus/metrics",
            "title": "Metrics",
            "description": "Collect Vault metrics via prometheus."
          }
        ]
      }
    ],
    "owner": {
      "github": "elastic/security-external-integrations"
    }
  },
  "data_streams": {
    "audit": {
      "manifest": {
        "title": "Hashicorp Vault Audit Logs",
        "type": "logs",
        "streams": [
          {
            "input": "logfile",
            "description": "Collect Vault audit logs from file.",
            "title": "Audit logs (file audit device)",
            "template_path": "logfile.yml.hbs",
            "vars": [
              {
                "name": "paths",
                "default": [
                  "/var/log/vault/audit*.json*"
                ],
                "type": "text",
                "title": "Paths",
                "multi": true,
                "show_user": true
              },
              {
                "name": "preserve_original_event",
                "default": false,
                "description": "Preserves a raw copy of the original event, added to the field `event.original`.",
                "type": "bool",
                "title": "Preserve original event",
                "multi": false,
                "required": true,
                "show_user": true
              },
              {
                "name": "tags",
                "default": [
                  "hashicorp-vault-audit"
                ],
                "type": "text",
                "title": "Tags",
                "multi": true,
                "required": true,
                "show_user": false
              },
              {
                "name": "processors",
                "description": "Processors are used to reduce the number of fields in the exported event or to enhance the event with metadata.  This executes in the agent before the logs are parsed. See [Processors](https://www.elastic.co/guide/en/beats/filebeat/current/filtering-and-enhancing-data.html) for details.\n",
                "type": "yaml",
                "title": "Processors",
                "multi": false,
                "required": false,
                "show_user": false
              }
            ]
          },
          {
            "input": "tcp",
            "description": "Collect Vault audit logs from TCP socket.",
            "title": "Audit logs (socket audit device)",
            "template_path": "tcp.yml.hbs",
            "vars": [
              {
                "name": "listen_address",
                "default": "localhost",
                "description": "The bind address to listen for TCP connections. Set to `0.0.0.0` to bind to all available interfaces.",
                "type": "text",
                "title": "Listen Address",
                "multi": false,
                "required": true,
                "show_user": true
              },
              {
                "name": "listen_port",
                "default": 9007,
                "description": "The TCP port number to listen on.",
                "type": "integer",
                "title": "Listen Port",
                "multi": false,
                "required": true,
                "show_user": true
              },
              {
                "name": "preserve_original_event",
                "default": false,
                "description": "Preserves a raw copy of the original event, added to the field `event.original`.",
                "type": "bool",
                "title": "Preserve original event",
                "multi": false,
                "required": true,
                "show_user": true
              },
              {
                "name": "tags",
                "default": [
                  "hashicorp-vault-audit",
                  "forwarded"
                ],
                "type": "text",
                "title": "Tags",
                "multi": true,
                "required": true,
                "show_user": false
              },
              {
                "name": "processors",
                "description": "Processors are used to reduce the number of fields in the exported event or to enhance the event with metadata.  This executes in the agent before the logs are parsed. See [Processors](https://www.elastic.co/guide/en/beats/filebeat/current/filtering-and-enhancing-data.html) for details.\n",
                "type": "yaml",
                "title": "Processors",
                "multi": false,
                "required": false,
                "show_user": false
              }
            ],
            "enabled": false
          }
        ]
      },
      "pipelines": {
        "default.yml": {
          "description": "Pipeline for processing Hashicorp Vault audit logs.",
          "processors": [
            {
              "set": {
                "field": "ecs.version",
                "value": "8.7.0"
              }
            },
            {
              "rename": {
                "field": "message",
                "ignore_failure": true,
                "ignore_missing": true,
                "target_field": "event.original"
              }
            },
            {
              "json": {
                "field": "event.original",
                "ignore_failure": true,
                "target_field": "hashicorp_vault.audit"
              }
            },
            {
              "date": {
                "field": "hashicorp_vault.audit.time",
                "formats": [
                  "ISO8601"
                ]
              }
            },
            {
              "remove": {
                "field": [
                  "hashicorp_vault.audit.time"
                ],
                "ignore_missing": true
              }
            },
            {
              "set": {
                "field": "event.kind",
                "value": "event"
              }
            },
            {
              "append": {
                "field": "event.category",
                "value": "authentication"
              }
            },
            {
              "append": {
                "field": "event.type",
                "if": "ctx?.hashicorp_vault?.audit?.request?.operation == 'create'",
                "value": "creation"
              }
            },
            {
              "append": {
                "field": "event.type",
                "if": "ctx?.hashicorp_vault?.audit?.request?.operation == 'delete'",
                "value": "deletion"
              }
            },
            {
              "append": {
                "field": "event.type",
                "if": "ctx?.hashicorp_vault?.audit?.request?.operation == 'update'",
                "value": "change"
              }
            },
            {
              "append": {
                "field": "event.type",
                "if": "ctx?.hashicorp_vault?.audit?.request?.operation == 'read' || ctx?.hashicorp_vault?.audit?.request?.operation == 'list'",
                "value": "access"
              }
            },
            {
              "append": {
                "field": "event.type",
                "if": "ctx?.hashicorp_vault?.audit?.error != null",
                "value": "error"
              }
            },
            {
              "append": {
                "field": "event.type",
                "if": "ctx?.hashicorp_vault?.audit?.error != null \u0026\u0026 ctx.hashicorp_vault.audit.error.contains(\"denied\")",
                "value": "denied"
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.request.operation",
                "field": "event.action"
              }
            },
            {
              "set": {
                "field": "event.outcome",
                "if": "ctx?.hashicorp_vault?.audit?.error == null",
                "value": "success"
              }
            },
            {
              "set": {
                "field": "event.outcome",
                "if": "ctx?.hashicorp_vault?.audit?.error != null",
                "value": "failure"
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.request.id",
                "field": "event.id",
                "ignore_failure": true
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.error",
                "field": "message",
                "ignore_failure": true
              }
            },
            {
              "convert": {
                "field": "hashicorp_vault.audit.request.remote_address",
                "ignore_missing": true,
                "target_field": "source.ip",
                "type": "ip"
              }
            },
            {
              "convert": {
                "field": "hashicorp_vault.audit.request.remote_port",
                "ignore_missing": true,
                "target_field": "source.port",
                "type": "long"
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.auth.metadata.email",
                "field": "user.email",
                "ignore_failure": true
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.auth.metadata.account_id",
                "field": "user.id",
                "ignore_failure": true
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.auth.metadata.AllocationID",
                "field": "nomad.allocation.id",
                "if": "ctx?.hashicorp_vault?.audit?.auth?.metadata?.AllocationID != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.NodeID != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.Namespace != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.Task != null\n",
                "ignore_failure": true
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.auth.metadata.Namespace",
                "field": "nomad.namespace",
                "if": "ctx?.hashicorp_vault?.audit?.auth?.metadata?.AllocationID != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.NodeID != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.Namespace != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.Task != null\n",
                "ignore_failure": true
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.auth.metadata.NodeID",
                "field": "nomad.node.id",
                "if": "ctx?.hashicorp_vault?.audit?.auth?.metadata?.AllocationID != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.NodeID != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.Namespace != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.Task != null\n",
                "ignore_failure": true
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.audit.auth.metadata.Task",
                "field": "nomad.task.name",
                "if": "ctx?.hashicorp_vault?.audit?.auth?.metadata?.AllocationID != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.NodeID != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.Namespace != null \u0026\u0026 ctx?.hashicorp_vault?.audit?.auth?.metadata?.Task != null\n",
                "ignore_failure": true
              }
            },
            {
              "geoip": {
                "field": "source.ip",
                "ignore_missing": true,
                "target_field": "source.geo"
              }
            },
            {
              "geoip": {
                "database_file": "GeoLite2-ASN.mmdb",
                "field": "source.ip",
                "ignore_missing": true,
                "properties": [
                  "asn",
                  "organization_name"
                ],
                "target_field": "source.as"
              }
            },
            {
              "rename": {
                "field": "source.as.asn",
                "ignore_missing": true,
                "target_field": "source.as.number"
              }
            },
            {
              "rename": {
                "field": "source.as.organization_name",
                "ignore_missing": true,
                "target_field": "source.as.organization.name"
              }
            },
            {
              "append": {
                "allow_duplicates": false,
                "field": "related.ip",
                "if": "ctx?.source?.ip != null",
                "value": "{{{source.ip}}}"
              }
            },
            {
              "remove": {
                "field": "event.original",
                "if": "ctx?.tags == null || !(ctx.tags.contains('preserve_original_event'))",
                "ignore_failure": true,
                "ignore_missing": true
              }
            }
          ],
          "on_failure": [
            {
              "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
              }
            }
          ]
        }
      },
      "sample_event": {
        "event": {
          "@timestamp": "2022-08-18T17:07:22.769Z",
          "agent": {
            "ephemeral_id": "623671b3-bcc9-4060-9806-e1cb0b945aae",
            "id": "03109bfa-7015-46bd-9433-3879357210cd",
            "name": "docker-fleet-agent",
            "type": "filebeat",
            "version": "8.3.2"
          },
          "data_stream": {
            "dataset": "hashicorp_vault.audit",
            "namespace": "ep",
            "type": "logs"
          },
          "ecs": {
            "version": "8.7.0"
          },
          "elastic_agent": {
            "id": "03109bfa-7015-46bd-9433-3879357210cd",
            "snapshot": false,
            "version": "8.3.2"
          },
          "event": {
            "action": "update",
            "agent_id_status": "verified",
            "category": [
              "authentication"
            ],
            "dataset": "hashicorp_vault.audit",
            "id": "e54c706f-1a3d-9662-3705-872e05c9c39f",
            "ingested": "2022-08-18T17:07:55Z",
            "kind": "event",
            "original": "{\"time\":\"2022-08-18T17:07:22.76907021Z\",\"type\":\"request\",\"auth\":{\"token_type\":\"default\"},\"request\":{\"id\":\"e54c706f-1a3d-9662-3705-872e05c9c39f\",\"operation\":\"update\",\"namespace\":{\"id\":\"root\"},\"path\":\"sys/audit/test\"}}",
            "outcome": "success",
            "type": [
              "change"
            ]
          },
          "hashicorp_vault": {
            "audit": {
              "auth": {
                "token_type": "default"
              },
              "request": {
                "id": "e54c706f-1a3d-9662-3705-872e05c9c39f",
                "namespace": {
                  "id": "root"
                },
                "operation": "update",
                "path": "sys/audit/test"
              },
              "type": "request"
            }
          },
          "host": {
            "architecture": "x86_64",
            "containerized": false,
            "hostname": "docker-fleet-agent",
            "ip": [
              "172.23.0.7"
            ],
            "mac": [
              "02:42:ac:17:00:07"
            ],
            "name": "docker-fleet-agent",
            "os": {
              "codename": "focal",
              "family": "debian",
              "kernel": "5.10.76-linuxkit",
              "name": "Ubuntu",
              "platform": "ubuntu",
              "type": "linux",
              "version": "20.04.4 LTS (Focal Fossa)"
            }
          },
          "input": {
            "type": "log"
          },
          "log": {
            "file": {
              "path": "/tmp/service_logs/vault/audit.json"
            },
            "offset": 0
          },
          "tags": [
            "preserve_original_event",
            "hashicorp-vault-audit"
          ]
        }
      }
    },
    "log": {
      "manifest": {
        "title": "Hashicorp Vault Operational Logs",
        "type": "logs",
        "streams": [
          {
            "input": "logfile",
            "description": "Collect Vault operational logs from file.",
            "title": "Operation logs",
            "template_path": "logfile.yml.hbs",
            "vars": [
              {
                "name": "paths",
                "default": [
                  "/var/log/vault/log*.json*"
                ],
                "type": "text",
                "title": "Paths",
                "multi": true,
                "show_user": true
              },
              {
                "name": "preserve_original_event",
                "default": false,
                "description": "Preserves a raw copy of the original event, added to the field `event.original`.",
                "type": "bool",
                "title": "Preserve original event",
                "multi": false,
                "required": true,
                "show_user": true
              },
              {
                "name": "tags",
                "default": [
                  "hashicorp-vault-log"
                ],
                "type": "text",
                "title": "Tags",
                "multi": true,
                "required": true,
                "show_user": false
              },
              {
                "name": "processors",
                "description": "Processors are used to reduce the number of fields in the exported event or to enhance the event with metadata.  This executes in the agent before the logs are parsed. See [Processors](https://www.elastic.co/guide/en/beats/filebeat/current/filtering-and-enhancing-data.html) for details.\n",
                "type": "yaml",
                "title": "Processors",
                "multi": false,
                "required": false,
                "show_user": false
              }
            ]
          }
        ]
      },
      "pipelines": {
        "default.yml": {
          "description": "Pipeline for processing Hashicorp Vault operational logs.",
          "processors": [
            {
              "set": {
                "field": "ecs.version",
                "value": "8.7.0"
              }
            },
            {
              "set": {
                "field": "event.kind",
                "value": "event"
              }
            },
            {
              "rename": {
                "field": "message",
                "ignore_failure": true,
                "target_field": "event.original"
              }
            },
            {
              "pipeline": {
                "if": "ctx?.event?.original != null \u0026\u0026 ctx.event.original.startsWith(\"{\")",
                "name": "{{ IngestPipeline \"json\" }}"
              }
            },
            {
              "set": {
                "copy_from": "event.original",
                "field": "message",
                "if": "ctx?.event?.original != null \u0026\u0026 !ctx.event.original.startsWith(\"{\")",
                "ignore_failure": true
              }
            },
            {
              "remove": {
                "field": "event.original",
                "if": "ctx?.tags == null || !(ctx.tags.contains('preserve_original_event'))",
                "ignore_failure": true,
                "ignore_missing": true
              }
            }
          ],
          "on_failure": [
            {
              "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
              }
            }
          ]
        },
        "json.yml": {
          "description": "Pipeline for processing Hashicorp Vault operational logs in JSON format.",
          "processors": [
            {
              "json": {
                "field": "event.original",
                "target_field": "hashicorp_vault.log"
              }
            },
            {
              "date": {
                "field": "hashicorp_vault.log.@timestamp",
                "formats": [
                  "ISO8601"
                ]
              }
            },
            {
              "remove": {
                "field": [
                  "hashicorp_vault.log.@timestamp"
                ],
                "ignore_missing": true
              }
            },
            {
              "rename": {
                "field": "hashicorp_vault.log.@level",
                "ignore_missing": true,
                "target_field": "log.level"
              }
            },
            {
              "rename": {
                "field": "hashicorp_vault.log.@message",
                "ignore_missing": true,
                "target_field": "message"
              }
            },
            {
              "rename": {
                "field": "hashicorp_vault.log.@module",
                "ignore_missing": true,
                "target_field": "log.logger"
              }
            },
            {
              "script": {
                "description": "Drop hashicorp_vault.log if empty.",
                "if": "ctx?.hashicorp_vault?.log != null \u0026\u0026 ctx.hashicorp_vault.log.isEmpty()",
                "lang": "painless",
                "source": "ctx.hashicorp_vault.remove(\"log\");\nif (ctx.hashicorp_vault.isEmpty()) {\n  ctx.remove(\"hashicorp_vault\");\n}\n",
                "tag": "drop-empty-hashicorp_vault.log"
              }
            },
            {
              "set": {
                "copy_from": "hashicorp_vault.log.file_path",
                "field": "file.path",
                "ignore_failure": true
              }
            }
          ],
          "on_failure": [
            {
              "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
              }
            }
          ]
        }
      },
      "sample_event": {
        "event": {
          "@timestamp": "2022-01-13T01:56:49.423Z",
          "agent": {
            "ephemeral_id": "519f95f7-ce93-4b23-b4ba-cb55bee8d69c",
            "id": "9878d192-22ad-49b6-a6c2-9959b0815d04",
            "name": "docker-fleet-agent",
            "type": "filebeat",
            "version": "8.0.0-beta1"
          },
          "data_stream": {
            "dataset": "hashicorp_vault.log",
            "namespace": "ep",
            "type": "logs"
          },
          "ecs": {
            "version": "8.7.0"
          },
          "elastic_agent": {
            "id": "9878d192-22ad-49b6-a6c2-9959b0815d04",
            "snapshot": false,
            "version": "8.0.0-beta1"
          },
          "event": {
            "agent_id_status": "verified",
            "dataset": "hashicorp_vault.log",
            "ingested": "2022-01-13T01:57:16Z",
            "kind": "event",
            "original": "{\"@level\":\"info\",\"@message\":\"proxy environment\",\"@timestamp\":\"2022-01-13T01:56:49.423084Z\",\"http_proxy\":\"\",\"https_proxy\":\"\",\"no_proxy\":\"\"}"
          },
          "hashicorp_vault": {
            "log": {
              "http_proxy": "",
              "https_proxy": "",
              "no_proxy": ""
            }
          },
          "host": {
            "architecture": "x86_64",
            "containerized": true,
            "hostname": "docker-fleet-agent",
            "id": "4ccba669f0df47fa3f57a9e4169ae7f1",
            "ip": [
              "172.18.0.4"
            ],
            "mac": [
              "02:42:ac:12:00:04"
            ],
            "name": "docker-fleet-agent",
            "os": {
              "codename": "Core",
              "family": "redhat",
              "kernel": "5.11.0-44-generic",
              "name": "CentOS Linux",
              "platform": "centos",
              "type": "linux",
              "version": "7 (Core)"
            }
          },
          "input": {
            "type": "log"
          },
          "log": {
            "file": {
              "path": "/tmp/service_logs/log.json"
            },
            "level": "info",
            "offset": 679
          },
          "message": "proxy environment",
          "tags": [
            "preserve_original_event",
            "hashicorp-vault-log"
          ]
        }
      }
    },
    "metrics": {
      "manifest": {
        "title": "Hashicorp Vault Metrics",
        "type": "metrics",
        "streams": [
          {
            "input": "prometheus/metrics",
            "description": "Collect prometheus metrics from Vault.",
            "title": "Vault metrics (prometheus)",
            "template_path": "metrics.yml.hbs",
            "vars": [
              {
                "name": "period",
                "default": "30s",
                "type": "text",
                "title": "Period"
              },
              {
                "name": "hosts",
                "default": [
                  "http://localhost:8200"
                ],
                "description": "Vault addresses to monitor. `/v1/sys/metrics?format=prometheus` is automatically appended.",
                "type": "text",
                "title": "Hosts",
                "multi": true,
                "required": true,
                "show_user": true
              },
              {
                "name": "vault_token",
                "description": "A Vault token with read access to the /sys/metrics API.",
                "type": "text",
                "title": "Vault Token",
                "multi": false,
                "required": true,
                "show_user": true
              },
              {
                "name": "processors",
                "description": "Processors are used to reduce the number of fields in the exported event or to enhance the event with metadata. This executes in the agent before the logs are parsed. See [Processors](https://www.elastic.co/guide/en/beats/metricbeat/current/filtering-and-enhancing-data.html) for details.\n",
                "type": "yaml",
                "title": "Processors",
                "multi": false,
                "required": false,
                "show_user": false
              },
              {
                "name": "ssl",
                "default": "#certificate_authorities:\n#  - |\n#    -----BEGIN CERTIFICATE-----\n#    MIIDCjCCAfKgAwIBAgITJ706Mu2wJlKckpIvkWxEHvEyijANBgkqhkiG9w0BAQsF\n#    -----END CERTIFICATE-----",
                "description": "i.e. certificate_authorities, supported_protocols, verification_mode etc.",
                "type": "yaml",
                "title": "SSL Configuration",
                "multi": false,
                "required": false,
                "show_user": false
              }
            ]
          }
        ],
        "elasticsearch": {
          "index_template": {
            "mappings": {
              "dynamic": true,
              "dynamic_templates": [
                {
                  "all_values": {
                    "mapping": {
                      "type": "double"
                    },
                    "path_match": "hashicorp_vault.metrics.*.value"
                  }
                },
                {
                  "all_counters": {
                    "mapping": {
                      "type": "double"
                    },
                    "path_match": "hashicorp_vault.metrics.*.counter"
                  }
                },
                {
                  "all_rates": {
                    "mapping": {
                      "type": "double"
                    },
                    "path_match": "hashicorp_vault.metrics.*.rate"
                  }
                },
                {
                  "all_histograms": {
                    "mapping": {
                      "type": "histogram"
                    },
                    "path_match": "hashicorp_vault.metrics.*.histogram"
                  }
                }
              ]
            }
          }
        }
      },
      "pipelines": {
        "default.yml": {
          "description": "Pipeline for processing Hashicorp Vault metrics.",
          "processors": [
            {
              "remove": {
                "field": [
                  "event.dataset",
                  "event.module",
                  "metricset.name",
                  "service.address",
                  "service.type"
                ],
                "ignore_missing": true
              }
            },
            {
              "set": {
                "field": "ecs.version",
                "value": "8.7.0"
              }
            },
            {
              "set": {
                "field": "service.type",
                "value": "hashicorp_vault"
              }
            },
            {
              "set": {
                "field": "event.kind",
                "value": "metric"
              }
            },
            {
              "rename": {
                "field": "prometheus.labels",
                "ignore_missing": true,
                "target_field": "labels"
              }
            },
            {
              "set": {
                "field": "labels.job",
                "override": true,
                "value": "hashicorp_vault"
              }
            },
            {
              "rename": {
                "field": "prometheus",
                "ignore_missing": true,
                "target_field": "hashicorp_vault.metrics"
              }
            }
          ],
          "on_failure": [
            {
              "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
              }
            }
          ]
        }
      },
      "sample_event": {
        "event": {
          "@timestamp": "2022-01-13T01:58:13.388Z",
          "agent": {
            "ephemeral_id": "6c9fb82b-59c7-43dd-b429-5d5a8f60f994",
            "id": "9878d192-22ad-49b6-a6c2-9959b0815d04",
            "name": "docker-fleet-agent",
            "type": "metricbeat",
            "version": "8.0.0-beta1"
          },
          "data_stream": {
            "dataset": "hashicorp_vault.metrics",
            "namespace": "ep",
            "type": "metrics"
          },
          "ecs": {
            "version": "8.7.0"
          },
          "elastic_agent": {
            "id": "9878d192-22ad-49b6-a6c2-9959b0815d04",
            "snapshot": false,
            "version": "8.0.0-beta1"
          },
          "event": {
            "agent_id_status": "verified",
            "duration": 2522433,
            "ingested": "2022-01-13T01:58:13Z",
            "kind": "metric"
          },
          "hashicorp_vault": {
            "metrics": {
              "go_gc_duration_seconds_count": {
                "counter": 6,
                "rate": 0
              },
              "go_gc_duration_seconds_sum": {
                "counter": 0.000178341,
                "rate": 0
              },
              "go_goroutines": {
                "value": 235
              },
              "go_memstats_alloc_bytes": {
                "value": 12255384
              },
              "go_memstats_alloc_bytes_total": {
                "counter": 34001072,
                "rate": 0
              },
              "go_memstats_buck_hash_sys_bytes": {
                "value": 1463139
              },
              "go_memstats_frees_total": {
                "counter": 150857,
                "rate": 0
              },
              "go_memstats_gc_cpu_fraction": {
                "value": 0.0019060616740776953
              },
              "go_memstats_gc_sys_bytes": {
                "value": 5881672
              },
              "go_memstats_heap_alloc_bytes": {
                "value": 12255384
              },
              "go_memstats_heap_idle_bytes": {
                "value": 50307072
              },
              "go_memstats_heap_inuse_bytes": {
                "value": 15523840
              },
              "go_memstats_heap_objects": {
                "value": 47319
              },
              "go_memstats_heap_released_bytes": {
                "value": 44326912
              },
              "go_memstats_heap_sys_bytes": {
                "value": 65830912
              },
              "go_memstats_last_gc_time_seconds": {
                "value": 1642039090.5779526
              },
              "go_memstats_lookups_total": {
                "counter": 0,
                "rate": 0
              },
              "go_memstats_mallocs_total": {
                "counter": 198176,
                "rate": 0
              },
              "go_memstats_mcache_inuse_bytes": {
                "value": 1200
              },
              "go_memstats_mcache_sys_bytes": {
                "value": 16384
              },
              "go_memstats_mspan_inuse_bytes": {
                "value": 175440
              },
              "go_memstats_mspan_sys_bytes": {
                "value": 196608
              },
              "go_memstats_next_gc_bytes": {
                "value": 24046448
              },
              "go_memstats_other_sys_bytes": {
                "value": 389469
              },
              "go_memstats_stack_inuse_bytes": {
                "value": 1277952
              },
              "go_memstats_stack_sys_bytes": {
                "value": 1277952
              },
              "go_memstats_sys_bytes": {
                "value": 75056136
              },
              "go_threads": {
                "value": 6
              },
              "process_cpu_seconds_total": {
                "counter": 0.12,
                "rate": 0
              },
              "process_max_fds": {
                "value": 1048576
              },
              "process_open_fds": {
                "value": 12
              },
              "process_resident_memory_bytes": {
                "value": 94257152
              },
              "process_start_time_seconds": {
                "value": 1642039069.4
              },
              "process_virtual_memory_bytes": {
                "value": 852996096
              },
              "process_virtual_memory_max_bytes": {
                "value": -1
              }
            }
          },
          "host": {
            "architecture": "x86_64",
            "containerized": true,
            "hostname": "docker-fleet-agent",
            "id": "4ccba669f0df47fa3f57a9e4169ae7f1",
            "ip": [
              "172.18.0.4"
            ],
            "mac": [
              "02:42:ac:12:00:04"
            ],
            "name": "docker-fleet-agent",
            "os": {
              "codename": "Core",
              "family": "redhat",
              "kernel": "5.11.0-44-generic",
              "name": "CentOS Linux",
              "platform": "centos",
              "type": "linux",
              "version": "7 (Core)"
            }
          },
          "labels": {
            "instance": "hashicorp_vault:8200",
            "job": "hashicorp_vault"
          },
          "metricset": {
            "period": 5000
          },
          "service": {
            "type": "hashicorp_vault"
          }
        }
      }
    }
  }
}
